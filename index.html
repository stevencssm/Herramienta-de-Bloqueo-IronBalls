<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IronBalls ‚Äî Herramienta de Bloqueo v2.2</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=JetBrains+Mono:wght@400;500;600;700&family=Playfair+Display:wght@700;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-deep: #08090d;
    --bg-card: #10111a;
    --bg-card-hover: #151725;
    --bg-input: #181a28;
    --bg-surface: #1e2035;
    --border: #262940;
    --border-subtle: #1e2038;
    --text-primary: #ebedf5;
    --text-secondary: #8b90a8;
    --text-muted: #555878;
    --accent-blue: #5b8cff;
    --accent-blue-glow: rgba(91, 140, 255, 0.18);
    --accent-green: #3ee0a5;
    --accent-green-glow: rgba(62, 224, 165, 0.18);
    --accent-red: #ff7b7b;
    --accent-red-glow: rgba(255, 123, 123, 0.18);
    --accent-amber: #ffcb45;
    --accent-amber-glow: rgba(255, 203, 69, 0.18);
    --accent-purple: #b49bff;
    --accent-purple-glow: rgba(180, 155, 255, 0.18);
    --radius-sm: 10px; --radius-md: 14px; --radius-lg: 20px; --radius-xl: 28px;
    --shadow-glow: 0 0 80px rgba(91, 140, 255, 0.1);
    --shadow-card: 0 4px 24px rgba(0,0,0,.3);
    --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'DM Sans', sans-serif; background: var(--bg-deep); color: var(--text-primary); min-height: 100vh; overflow-x: hidden; -webkit-font-smoothing: antialiased; }

  .bg-mesh { position: fixed; inset: 0; z-index: 0; background: radial-gradient(ellipse 80% 50% at 20% 20%, rgba(74,124,255,0.06) 0%, transparent 60%), radial-gradient(ellipse 60% 40% at 80% 80%, rgba(167,139,250,0.04) 0%, transparent 60%), radial-gradient(ellipse 50% 50% at 50% 50%, rgba(52,211,153,0.03) 0%, transparent 60%); animation: meshShift 20s ease-in-out infinite alternate; }
  @keyframes meshShift { 0% { opacity:.7 } 50% { opacity:1 } 100% { opacity:.7 } }
  .bg-grid { position: fixed; inset: 0; z-index: 0; background-image: linear-gradient(rgba(255,255,255,0.015) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.015) 1px, transparent 1px); background-size: 60px 60px; }

  .app { position: relative; z-index: 1; max-width: 680px; margin: 0 auto; padding: 32px 20px 80px; }

  /* Header */
  .header { text-align: center; margin-bottom: 40px; animation: fadeDown .8s ease-out; }
  @keyframes fadeDown { from { opacity:0; transform:translateY(-20px) } to { opacity:1; transform:translateY(0) } }
  .header-logo { display: inline-flex; align-items: center; gap: 12px; margin-bottom: 12px; }
  .logo-icon { width: 48px; height: 48px; border-radius: 14px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); display: flex; align-items: center; justify-content: center; font-size: 22px; box-shadow: 0 4px 20px rgba(74,124,255,0.3); animation: pulse 3s ease-in-out infinite; }
  @keyframes pulse { 0%,100% { box-shadow: 0 4px 20px rgba(74,124,255,0.3) } 50% { box-shadow: 0 4px 30px rgba(74,124,255,0.5) } }
  .header h1 { font-family: 'Playfair Display', serif; font-size: 2rem; font-weight: 800; background: linear-gradient(135deg, var(--text-primary), var(--accent-blue)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .header-sub { font-size: .88rem; color: var(--text-secondary); margin-top: 6px; line-height: 1.5; }
  .version-badge { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: .7rem; font-weight: 600; color: var(--accent-blue); background: var(--accent-blue-glow); border: 1px solid rgba(74,124,255,.2); margin-top: 10px; letter-spacing: .05em; }

  /* PDT context banner */
  .pdt-banner { background: var(--bg-surface); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 16px 20px; margin-bottom: 28px; font-size: .82rem; color: var(--text-secondary); line-height: 1.65; animation: fadeUp .6s ease-out; position: relative; overflow: hidden; }
  .pdt-banner::before { content:''; position:absolute; left:0; top:0; bottom:0; width:3px; background: linear-gradient(180deg, var(--accent-blue), var(--accent-purple)); border-radius: 3px 0 0 3px; }
  .pdt-banner strong { color: var(--text-primary); }

  /* Progress */
  .progress-bar { display: flex; gap: 6px; margin-bottom: 32px; padding: 0 4px; animation: fadeDown .6s ease-out; }
  .progress-step { flex: 1; height: 3px; border-radius: 3px; background: var(--border); transition: background .4s ease; }
  .progress-step.done { background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple)); }
  .progress-step.current { background: linear-gradient(90deg, var(--accent-blue), transparent); }

  /* Cards */
  .card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 28px; margin-bottom: 20px; position: relative; overflow: hidden; transition: var(--transition); animation: fadeUp .6s ease-out backwards; box-shadow: var(--shadow-card); }
  .card:nth-child(1){animation-delay:.05s} .card:nth-child(2){animation-delay:.1s} .card:nth-child(3){animation-delay:.15s} .card:nth-child(4){animation-delay:.2s} .card:nth-child(5){animation-delay:.25s} .card:nth-child(6){animation-delay:.3s}
  @keyframes fadeUp { from { opacity:0; transform:translateY(24px) } to { opacity:1; transform:translateY(0) } }
  .card:hover { border-color: rgba(74,124,255,.15); background: var(--bg-card-hover); }
  .card::before { content:''; position:absolute; top:0; left:0; right:0; height:1px; background:linear-gradient(90deg, transparent, rgba(74,124,255,.3), transparent); opacity:0; transition: opacity var(--transition); }
  .card:hover::before { opacity:1; }

  .step-label { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
  .step-num { width: 28px; height: 28px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); color: white; font-size: .75rem; font-weight: 700; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
  .step-title { font-size: .8rem; font-weight: 600; text-transform: uppercase; letter-spacing: .08em; color: var(--text-secondary); }
  .step-hint { font-size: .82rem; color: var(--text-muted); margin-bottom: 18px; line-height: 1.5; padding-left: 38px; }

  /* Options */
  .opts { display: grid; gap: 10px; }
  .opts.c2 { grid-template-columns: 1fr 1fr; }
  .opts.c3 { grid-template-columns: 1fr 1fr 1fr; }
  .opts.c4 { grid-template-columns: 1fr 1fr; }

  .opt { position: relative; background: var(--bg-input); border: 1.5px solid var(--border); border-radius: var(--radius-md); padding: 16px 14px; cursor: pointer; transition: all .25s ease; text-align: center; overflow: hidden; }
  .opt:hover { border-color: rgba(74,124,255,.3); transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,.2); }
  .opt.on { border-color: var(--accent-blue); background: linear-gradient(135deg, rgba(74,124,255,.08), rgba(167,139,250,.05)); box-shadow: 0 0 24px var(--accent-blue-glow); }
  .opt.on-green { border-color: var(--accent-green); background: linear-gradient(135deg, rgba(52,211,153,.08), rgba(52,211,153,.03)); box-shadow: 0 0 24px var(--accent-green-glow); }
  .opt.on-red { border-color: var(--accent-red); background: linear-gradient(135deg, rgba(248,113,113,.08), rgba(248,113,113,.03)); box-shadow: 0 0 24px var(--accent-red-glow); }
  .opt.on-amber { border-color: var(--accent-amber); background: linear-gradient(135deg, rgba(251,191,36,.08), rgba(251,191,36,.03)); box-shadow: 0 0 24px var(--accent-amber-glow); }

  .opt-dot { width: 36px; height: 36px; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: transform .3s ease; }
  .opt:hover .opt-dot { transform: scale(1.15); }
  .opt.on .opt-dot, .opt.on-green .opt-dot, .opt.on-red .opt-dot, .opt.on-amber .opt-dot { transform: scale(1.2); }
  .dg { background: rgba(52,211,153,.15); color: var(--accent-green); }
  .db { background: rgba(74,124,255,.15); color: var(--accent-blue); }
  .da { background: rgba(251,191,36,.15); color: var(--accent-amber); }
  .dr { background: rgba(248,113,113,.15); color: var(--accent-red); }
  .dp { background: rgba(167,139,250,.15); color: var(--accent-purple); }
  .opt-name { font-size: .9rem; font-weight: 600; margin-bottom: 2px; }
  .opt-sub { font-size: .72rem; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; }

  /* Inputs */
  .irow { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .irow.s1 { grid-template-columns: 1fr; }
  .ig { position: relative; }
  .ig label { display: block; font-size: .75rem; font-weight: 500; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: .06em; }
  .ig input { width: 100%; padding: 14px 16px; background: var(--bg-input); border: 1.5px solid var(--border); border-radius: var(--radius-sm); color: var(--text-primary); font-family: 'JetBrains Mono', monospace; font-size: 1.05rem; font-weight: 500; outline: none; transition: all .25s ease; }
  .ig input::placeholder { color: var(--text-muted); font-weight: 400; }
  .ig input:focus { border-color: var(--accent-blue); box-shadow: 0 0 0 3px var(--accent-blue-glow); }
  .ig input:hover:not(:focus) { border-color: rgba(74,124,255,.25); }
  .itag { position: absolute; right: 12px; top: 50%; transform: translateY(20%); font-size: .7rem; font-weight: 600; color: var(--text-muted); background: var(--bg-card); padding: 2px 8px; border-radius: 4px; pointer-events: none; }

  .spread-info { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 14px; padding: 10px; background: rgba(74,124,255,.05); border-radius: var(--radius-sm); font-size: .82rem; color: var(--text-secondary); opacity: 0; transform: translateY(-8px); transition: all .4s ease; }
  .spread-info.vis { opacity: 1; transform: translateY(0); }
  .spread-info strong { font-family: 'JetBrains Mono', monospace; color: var(--accent-blue); }

  /* Target input area */
  .target-area { margin-top: 16px; overflow: hidden; max-height: 0; opacity: 0; transition: max-height .5s cubic-bezier(.4,0,.2,1), opacity .4s ease; }
  .target-area.vis { max-height: 200px; opacity: 1; }
  .target-ctx { display: flex; align-items: center; gap: 8px; padding: 12px 16px; border-radius: var(--radius-sm); font-size: .82rem; margin-bottom: 14px; line-height: 1.5; }
  .target-ctx.cg { background: rgba(62,224,165,.1); color: var(--accent-green); border: 1px solid rgba(62,224,165,.18); }
  .target-ctx.cr { background: rgba(255,123,123,.1); color: var(--accent-red); border: 1px solid rgba(255,123,123,.18); }

  /* Asset */
  .asset-box { display: flex; align-items: center; gap: 14px; padding: 14px 18px; background: var(--bg-input); border: 1.5px solid var(--border); border-radius: var(--radius-md); }
  .asset-tick { font-family: 'JetBrains Mono', monospace; font-size: 1.3rem; font-weight: 700; }
  .asset-name { font-size: .82rem; color: var(--text-muted); }
  .asset-live { margin-left: auto; display: flex; align-items: center; gap: 6px; font-size: .72rem; color: var(--accent-green); font-weight: 600; }
  .live-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--accent-green); animation: blink 1.5s ease-in-out infinite; }
  @keyframes blink { 0%,100% { opacity:1 } 50% { opacity:.3 } }

  /* Results */
  .results { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-xl); padding: 40px 28px; margin-top: 32px; text-align: center; position: relative; overflow: hidden; animation: fadeUp .7s ease-out backwards; animation-delay: .4s; transition: all .5s ease; box-shadow: var(--shadow-card); }
  .results.has { border-color: rgba(91,140,255,.3); box-shadow: var(--shadow-glow), 0 8px 40px rgba(0,0,0,.4); }
  .results::before { content:''; position:absolute; top:-50%; left:-50%; width:200%; height:200%; background:radial-gradient(circle, rgba(91,140,255,.05), transparent 60%); pointer-events:none; }

  .r-label { font-size: .75rem; font-weight: 700; text-transform: uppercase; letter-spacing: .15em; color: var(--text-muted); margin-bottom: 8px; }
  .r-sub { font-size: .82rem; font-weight: 500; color: var(--text-secondary); margin-bottom: 16px; }
  .r-val { font-family: 'JetBrains Mono', monospace; font-size: 3.5rem; font-weight: 700; line-height: 1; margin-bottom: 6px; transition: all .5s ease; }
  .r-val.pos { color: var(--accent-green); }
  .r-val.neg { color: var(--accent-red); }
  .r-val.neu { color: var(--text-muted); }
  .r-unit { font-size: 1.4rem; font-weight: 500; opacity: .6; margin-left: 4px; }
  .r-conv { font-size: .85rem; color: var(--text-muted); margin-top: 6px; font-family: 'JetBrains Mono', monospace; }

  /* Divider */
  .r-div { display: flex; align-items: center; gap: 12px; margin: 24px 0 20px; color: var(--text-muted); }
  .r-div::before, .r-div::after { content:''; flex:1; height:1px; background: var(--border); }
  .r-div span { font-size: .7rem; font-weight: 700; text-transform: uppercase; letter-spacing: .12em; white-space: nowrap; }

  /* Target box */
  .t-box { background: var(--bg-input); border-radius: var(--radius-md); padding: 22px; border: 1px solid var(--border); opacity: 0; transform: translateY(8px); transition: all .5s ease; }
  .t-box.vis { opacity: 1; transform: translateY(0); }
  .t-lbl { font-size: .72rem; font-weight: 700; text-transform: uppercase; letter-spacing: .12em; margin-bottom: 10px; }
  .t-lbl.lg { color: var(--accent-green); }
  .t-lbl.lr { color: var(--accent-red); }
  .t-val { font-family: 'JetBrains Mono', monospace; font-size: 2.2rem; font-weight: 700; line-height: 1; }
  .t-val.vg { color: var(--accent-green); }
  .t-val.vr { color: var(--accent-red); }
  .t-sub { font-size: .78rem; color: var(--text-muted); margin-top: 6px; font-family: 'JetBrains Mono', monospace; }
  .t-expl { font-size: .78rem; color: var(--text-secondary); margin-top: 10px; line-height: 1.5; border-top: 1px solid var(--border); padding-top: 10px; }

  /* Educational Formula */
  .edu { margin-top: 28px; padding-top: 24px; border-top: 1px solid var(--border); opacity: 0; transform: translateY(12px); transition: all .5s ease; }
  .edu.vis { opacity: 1; transform: translateY(0); }
  .edu-title { display: flex; align-items: center; gap: 8px; font-size: .75rem; font-weight: 700; text-transform: uppercase; letter-spacing: .12em; color: var(--text-muted); margin-bottom: 18px; }
  .edu-title .ei { width: 22px; height: 22px; border-radius: 6px; background: rgba(167,139,250,.12); color: var(--accent-purple); display: flex; align-items: center; justify-content: center; font-size: 11px; }

  .edu-vars { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
  .ev { display: inline-flex; align-items: center; gap: 6px; padding: 5px 10px; border-radius: 6px; font-size: .76rem; font-family: 'JetBrains Mono', monospace; background: var(--bg-input); border: 1px solid var(--border); }
  .ev-icon { font-size: .85rem; }
  .ev-name { color: var(--text-muted); font-family: 'DM Sans', sans-serif; }
  .ev-val { color: var(--text-primary); font-weight: 600; }

  .edu-steps { display: flex; flex-direction: column; }
  .es { display: flex; align-items: flex-start; gap: 14px; padding: 14px 0; border-bottom: 1px solid rgba(255,255,255,.03); }
  .es:last-child { border-bottom: none; }
  .es-n { width: 24px; height: 24px; border-radius: 50%; flex-shrink: 0; background: var(--bg-input); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: .68rem; font-weight: 700; color: var(--text-muted); margin-top: 1px; }
  .es-n.done { background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border: none; color: white; }
  .es-b { flex: 1; }
  .es-d { font-size: .82rem; color: var(--text-secondary); line-height: 1.5; margin-bottom: 6px; }
  .es-eq { font-family: 'JetBrains Mono', monospace; font-size: .85rem; padding: 10px 14px; border-radius: 8px; background: var(--bg-surface); border-left: 3px solid var(--border); color: var(--text-primary); line-height: 1.7; }
  .es-eq.final { background: rgba(91,140,255,.08); border-left-color: var(--accent-blue); font-size: .92rem; font-weight: 600; }

  .edu-tip { margin-top: 16px; padding: 14px 16px; border-radius: var(--radius-sm); font-size: .82rem; line-height: 1.6; }
  .edu-tip.tg { background: rgba(62,224,165,.1); border: 1px solid rgba(62,224,165,.18); color: var(--accent-green); }
  .edu-tip.ta { background: rgba(255,203,69,.08); border: 1px solid rgba(255,203,69,.15); color: var(--accent-amber); }
  .edu-tip.tb { background: rgba(91,140,255,.1); border: 1px solid rgba(91,140,255,.18); color: var(--accent-blue); }
  .edu-tip.tr { background: rgba(255,123,123,.1); border: 1px solid rgba(255,123,123,.18); color: var(--accent-red); }

  /* Empty */
  .empty { padding: 24px 0; }
  .empty-ico { font-size: 2.5rem; margin-bottom: 12px; opacity: .4; }
  .empty-txt { font-size: .9rem; color: var(--text-muted); }

  /* Alerts */
  .alert { display: flex; align-items: flex-start; gap: 10px; padding: 12px 16px; border-radius: var(--radius-sm); font-size: .8rem; line-height: 1.5; margin-top: 14px; animation: pop .3s ease-out; }
  .alert.warn { background: rgba(255,123,123,.1); border: 1px solid rgba(255,123,123,.2); color: var(--accent-red); }
  .alert.info { background: rgba(91,140,255,.08); border: 1px solid rgba(91,140,255,.15); color: var(--accent-blue); }
  .alert-icon { flex-shrink: 0; font-size: 1rem; margin-top: 1px; }

  /* Lock operation name badge */
  .lock-badge { display: flex; align-items: flex-start; gap: 10px; padding: 12px 16px; border-radius: var(--radius-sm); font-size: .82rem; font-weight: 500; margin-bottom: 16px; line-height: 1.5; width: 100%; }
  .lock-badge.lb-credit { background: rgba(62,224,165,.1); border: 1px solid rgba(62,224,165,.18); color: var(--text-secondary); }
  .lock-badge.lb-debit { background: rgba(180,155,255,.1); border: 1px solid rgba(180,155,255,.18); color: var(--text-secondary); }
  .lock-badge .lb-arrow { font-size: 1.1rem; }
  .lock-badge .lb-name { color: var(--text-primary); }

  /* Ripple */
  .ripple { position: absolute; border-radius: 50%; background: rgba(74,124,255,.3); transform: scale(0); animation: rpl .6s ease-out; pointer-events: none; }
  @keyframes rpl { to { transform: scale(4); opacity: 0; } }
  @keyframes pop { from { opacity:0; transform:translateY(10px) } to { opacity:1; transform:translateY(0) } }
  .pop { animation: pop .4s ease-out; }

  @media (max-width: 480px) {
    .app { padding: 20px 14px 60px; }
    .card { padding: 20px; }
    .r-val { font-size: 2.6rem; }
    .t-val { font-size: 1.8rem; }
    .opts.c4 { grid-template-columns: 1fr 1fr; }
    .opts.c3 { grid-template-columns: 1fr; }
    .header h1 { font-size: 1.6rem; }
  }
</style>
</head>
<body>
<div class="bg-mesh"></div>
<div class="bg-grid"></div>

<div class="app">
  <header class="header">
    <div class="header-logo">
      <div class="logo-icon">üîí</div>
      <h1>IronBalls</h1>
    </div>
    <p class="header-sub">Calcula cu√°nto necesitas para bloquear ganancia o limitar p√©rdida<br>sin cerrar tu posici√≥n intrad√≠a</p>
    <span class="version-badge">v2.2 ‚Äî LOCK TOOL</span>
  </header>

  <div class="pdt-banner">
    <strong>¬øPara qu√© sirve?</strong> Si tienes una cuenta con menos de $25k (regla PDT), no puedes hacer day trades ilimitados. El bloqueo te permite asegurar ganancias o limitar p√©rdidas abriendo un spread opuesto, sin necesidad de cerrar la posici√≥n original el mismo d√≠a.
  </div>

  <div class="progress-bar">
    <div class="progress-step" id="p1"></div>
    <div class="progress-step" id="p2"></div>
    <div class="progress-step" id="p3"></div>
    <div class="progress-step" id="p4"></div>
    <div class="progress-step" id="p5"></div>
    <div class="progress-step" id="p6"></div>
  </div>

  <!-- 1: Type -->
  <div class="card">
    <div class="step-label"><div class="step-num">1</div><span class="step-title">Tipo de Spread Inicial</span></div>
    <p class="step-hint"><strong style="color:var(--accent-green)">PCS/CCS</strong> = recibiste cr√©dito ¬∑ <strong style="color:var(--accent-amber)">PDS/CDS</strong> = pagaste d√©bito</p>
    <div class="opts c4">
      <button class="opt" onclick="pick(this,'spread','PCS')"><div class="opt-dot dg">‚Üë</div><div class="opt-name">Put Credit</div><div class="opt-sub">PCS ¬∑ Alcista</div></button>
      <button class="opt" onclick="pick(this,'spread','CCS')"><div class="opt-dot dr">‚Üì</div><div class="opt-name">Call Credit</div><div class="opt-sub">CCS ¬∑ Bajista</div></button>
      <button class="opt" onclick="pick(this,'spread','PDS')"><div class="opt-dot dr">‚Üì</div><div class="opt-name">Put Debit</div><div class="opt-sub">PDS ¬∑ Bajista</div></button>
      <button class="opt" onclick="pick(this,'spread','CDS')"><div class="opt-dot dg">‚Üë</div><div class="opt-name">Call Debit</div><div class="opt-sub">CDS ¬∑ Alcista</div></button>
    </div>
  </div>

  <!-- 2: Unit -->
  <div class="card">
    <div class="step-label"><div class="step-num">2</div><span class="step-title">Unidad de Medida</span></div>
    <p class="step-hint">Puntos del mercado (1 pt = $100) o D√≥lares directos.</p>
    <div class="opts c2">
      <button class="opt on" onclick="pick(this,'unit','pts')"><div class="opt-dot dp">üìä</div><div class="opt-name">Puntos</div><div class="opt-sub">1 pt = $100</div></button>
      <button class="opt" onclick="pick(this,'unit','usd')"><div class="opt-dot dg">üíµ</div><div class="opt-name">D√≥lares</div><div class="opt-sub">USD directos</div></button>
    </div>
  </div>

  <!-- 3: Asset -->
  <div class="card">
    <div class="step-label"><div class="step-num">3</div><span class="step-title">Activo</span></div>
    <p class="step-hint">Optimizado para opciones sobre √≠ndices.</p>
    <div class="asset-box">
      <div><div class="asset-tick">SPX</div><div class="asset-name">S&P 500 Index</div></div>
      <div class="asset-live"><div class="live-dot"></div>ACTIVO</div>
    </div>
  </div>

  <!-- 4: Strikes -->
  <div class="card">
    <div class="step-label"><div class="step-num">4</div><span class="step-title">Strikes del Spread Inicial</span></div>
    <p class="step-hint"><strong style="color:var(--accent-green)">Buy</strong> = strike que compraste ¬∑ <strong style="color:var(--accent-red)">Sell</strong> = strike que vendiste</p>
    <div class="irow">
      <div class="ig"><label>Compra (Buy)</label><input type="number" id="inBuy" placeholder="6930" oninput="calc()"><span class="itag">BUY</span></div>
      <div class="ig"><label>Venta (Sell)</label><input type="number" id="inSell" placeholder="6935" oninput="calc()"><span class="itag">SELL</span></div>
    </div>
    <div class="spread-info" id="spInfo">Ancho del spread: <strong id="spW">‚Äî</strong></div>
    <div id="alertStrikes"></div>
  </div>

  <!-- 5: Premium -->
  <div class="card">
    <div class="step-label"><div class="step-num">5</div><span class="step-title" id="premTitle">Prima Recibida / Pagada</span></div>
    <p class="step-hint" id="premHint">Ingresa la prima de tu spread original.</p>
    <div class="irow s1">
      <div class="ig"><label id="premLbl">Prima</label><input type="number" id="inPrem" placeholder="1.80" step="0.01" oninput="calc()"><span class="itag" id="premTag">PTS</span></div>
    </div>
    <div id="alertPrem"></div>
  </div>

  <!-- 6: Goal -->
  <div class="card">
    <div class="step-label"><div class="step-num">6</div><span class="step-title">Objetivo del Bloqueo</span></div>
    <p class="step-hint">¬øQuieres asegurar ganancia, limitar p√©rdida, o llegar a break-even?</p>
    <div class="opts c3">
      <button class="opt" onclick="pickGoal(this,'profit')"><div class="opt-dot dg">üí∞</div><div class="opt-name">Asegurar Ganancia</div><div class="opt-sub">Lock profit</div></button>
      <button class="opt" onclick="pickGoal(this,'loss')"><div class="opt-dot dr">üõ°Ô∏è</div><div class="opt-name">Limitar P√©rdida</div><div class="opt-sub">Max loss cap</div></button>
      <button class="opt on-amber" onclick="pickGoal(this,'be')"><div class="opt-dot da">‚öñÔ∏è</div><div class="opt-name">Break-Even</div><div class="opt-sub">$0 neto</div></button>
    </div>
    <div class="target-area" id="tArea">
      <div class="target-ctx cg" id="tCtx">Ingresa la ganancia m√≠nima que deseas asegurar.</div>
      <div class="irow s1"><div class="ig"><label id="tLbl">Ganancia Deseada</label><input type="number" id="inTarget" placeholder="0.50" step="0.01" oninput="calc()"><span class="itag" id="tTag">PTS</span></div></div>
      <div id="alertTarget"></div>
    </div>
  </div>

  <!-- Results -->
  <div class="results" id="resPanel">
    <div id="empty" class="empty"><div class="empty-ico">üéØ</div><p class="empty-txt">Completa los par√°metros para calcular tu bloqueo</p></div>
    <div id="resContent" style="display:none">
      <div class="r-label" id="rLabel">CR√âDITO PARA BLOQUEO</div>
      <div class="r-sub" id="rSub"></div>
      <div class="r-val neu" id="rVal">0.00<span class="r-unit" id="rUnit">pts</span></div>
      <div class="r-conv" id="rConv"></div>

      <div id="tWrap" style="display:none">
        <div class="r-div"><span id="tDivLbl">Tu Objetivo</span></div>
        <div class="t-box" id="tBox">
          <div class="t-lbl lg" id="tBoxLbl"></div>
          <div class="t-val vg" id="tBoxVal"></div>
          <div class="t-sub" id="tBoxSub"></div>
          <div class="t-expl" id="tBoxExpl"></div>
        </div>
      </div>

      <div class="edu" id="edu">
        <div class="edu-title"><div class="ei">∆í</div>C√ìMO SE CALCULA</div>
        <div class="edu-vars" id="eduVars"></div>
        <div class="edu-steps" id="eduSteps"></div>
        <div id="eduTip"></div>
      </div>
    </div>
  </div>
</div>

<script>
const S = { type:null, unit:'pts', buy:null, sell:null, prem:null, goal:'be', target:null };

function pick(btn, group, val) {
  ripple(btn);
  btn.parentElement.querySelectorAll('.opt').forEach(b => { b.className = 'opt'; });
  btn.classList.add('opt','on');
  if (group === 'spread') S.type = val;
  if (group === 'unit') {
    S.unit = val;
    document.getElementById('premTag').textContent = val==='pts'?'PTS':'USD';
    document.getElementById('inPrem').placeholder = val==='pts'?'1.80':'180';
    document.getElementById('tTag').textContent = val==='pts'?'PTS':'USD';
    document.getElementById('inTarget').placeholder = val==='pts'?'0.50':'50';
  }
  prog(); calc();
}

function pickGoal(btn, goal) {
  ripple(btn);
  btn.parentElement.querySelectorAll('.opt').forEach(b => { b.className = 'opt'; });
  btn.classList.add('opt');
  const cm = { profit:'on-green', loss:'on-red', be:'on-amber' };
  btn.classList.add(cm[goal]);
  S.goal = goal;

  const area = document.getElementById('tArea');
  const ctx = document.getElementById('tCtx');
  const lbl = document.getElementById('tLbl');
  const inp = document.getElementById('inTarget');

  if (goal === 'be') {
    area.classList.remove('vis'); S.target = 0;
  } else if (goal === 'profit') {
    area.classList.add('vis');
    ctx.className = 'target-ctx cg';
    ctx.textContent = 'üí∞ Ingresa la ganancia m√≠nima que deseas asegurar en el peor escenario.';
    lbl.textContent = 'Ganancia Deseada';
    inp.placeholder = S.unit==='pts'?'0.50':'50';
  } else {
    area.classList.add('vis');
    ctx.className = 'target-ctx cr';
    ctx.textContent = 'üõ°Ô∏è Ingresa la p√©rdida m√°xima que est√°s dispuesto a aceptar.';
    lbl.textContent = 'P√©rdida M√°xima Aceptable';
    inp.placeholder = S.unit==='pts'?'1.00':'100';
  }
  prog(); calc();
}

function ripple(el) {
  const r = document.createElement('span'); r.classList.add('ripple');
  const rc = el.getBoundingClientRect(); const sz = Math.max(rc.width,rc.height);
  r.style.width=r.style.height=sz+'px'; r.style.left='50%'; r.style.top='50%';
  r.style.marginLeft=-(sz/2)+'px'; r.style.marginTop=-(sz/2)+'px';
  el.appendChild(r); setTimeout(()=>r.remove(),600);
}

function prog() {
  const ok = [S.type!==null, S.unit!==null, true, S.buy!==null&&S.sell!==null, S.prem!==null&&S.prem>0, S.goal==='be'||(S.target!==null&&S.target>0)];
  for (let i=0;i<6;i++) {
    const el=document.getElementById('p'+(i+1)); el.className='progress-step';
    if(ok[i]) el.classList.add('done'); else if(i>0&&ok[i-1]) el.classList.add('current');
  }
}

function calc() {
  const b=parseFloat(document.getElementById('inBuy').value);
  const s=parseFloat(document.getElementById('inSell').value);
  const p=parseFloat(document.getElementById('inPrem').value);
  const t=parseFloat(document.getElementById('inTarget').value);
  S.buy=isNaN(b)?null:b; S.sell=isNaN(s)?null:s; S.prem=isNaN(p)?null:p; S.target=isNaN(t)?null:t;
  prog();

  // Clear alerts
  document.getElementById('alertStrikes').innerHTML = '';
  document.getElementById('alertPrem').innerHTML = '';
  document.getElementById('alertTarget').innerHTML = '';

  // Spread width
  const info=document.getElementById('spInfo');
  let W = 0;
  if(S.buy!==null&&S.sell!==null) {
    W=Math.abs(S.sell-S.buy);
    document.getElementById('spW').textContent = S.unit==='pts' ? W+' pts ($'+(W*100)+')' : '$'+(W*100);
    info.classList.add('vis');

    // Strike validations
    if (S.buy === S.sell) {
      showAlert('alertStrikes', 'warn', 'Los strikes de compra y venta no pueden ser iguales.');
    } else if (W > 50) {
      showAlert('alertStrikes', 'info', 'El ancho del spread es muy amplio (' + W + ' pts). Verifica que los strikes sean correctos.');
    } else if (W < 1) {
      showAlert('alertStrikes', 'warn', 'El ancho del spread es menor a 1 punto. Verifica los strikes.');
    }
  } else info.classList.remove('vis');

  // Need base params
  if(!S.type||S.buy===null||S.sell===null||S.prem===null||S.prem<=0) {
    document.getElementById('empty').style.display='';
    document.getElementById('resContent').style.display='none';
    document.getElementById('resPanel').classList.remove('has');
    return;
  }

  W = Math.abs(S.sell - S.buy);
  const P = S.unit==='pts' ? S.prem : S.prem/100;
  const isCredit = (S.type==='PCS'||S.type==='CCS');

  // Premium validations
  if (S.unit === 'pts' && S.prem >= 100) {
    showAlert('alertPrem', 'info', 'Ingresaste ' + S.prem + ' puntos. ¬øQuisiste decir $' + S.prem + ' USD? Si es as√≠, cambia la unidad a D√≥lares.');
  } else if (S.unit === 'usd' && S.prem > 0 && S.prem < 5) {
    showAlert('alertPrem', 'info', 'Ingresaste $' + S.prem + ' USD. ¬øQuisiste decir ' + S.prem + ' puntos? Si es as√≠, cambia la unidad a Puntos.');
  }

  if (P >= W && W > 0) {
    showAlert('alertPrem', 'warn', isCredit
      ? 'La prima recibida (' + P.toFixed(2) + ' pts) no puede ser mayor o igual al ancho del spread (' + W + ' pts).'
      : 'El d√©bito pagado (' + P.toFixed(2) + ' pts) no puede ser mayor o igual al ancho del spread (' + W + ' pts).');
    document.getElementById('empty').style.display='';
    document.getElementById('resContent').style.display='none';
    document.getElementById('resPanel').classList.remove('has');
    return;
  }

  if (P <= 0) {
    showAlert('alertPrem', 'warn', 'La prima debe ser un valor positivo.');
    return;
  }

  let goalPts = 0;
  if (S.goal==='profit' && S.target>0) goalPts = S.unit==='pts' ? S.target : S.target/100;
  if (S.goal==='loss' && S.target>0) goalPts = S.unit==='pts' ? S.target : S.target/100;

  // Target validations
  if (S.goal === 'profit' && goalPts > 0 && goalPts >= W) {
    showAlert('alertTarget', 'warn', 'La ganancia deseada no puede ser mayor o igual al ancho del spread.');
  }
  if (S.goal === 'loss' && goalPts > 0 && goalPts >= W) {
    showAlert('alertTarget', 'warn', 'La p√©rdida m√°xima no puede ser mayor o igual al ancho del spread.');
  }
  if (S.goal === 'profit' && S.unit === 'pts' && S.target >= 100) {
    showAlert('alertTarget', 'info', 'Ingresaste ' + S.target + ' puntos. ¬øQuisiste decir $' + S.target + '? Si es as√≠, cambia a D√≥lares.');
  }
  if (S.goal !== 'be' && S.unit === 'usd' && S.target > 0 && S.target < 5) {
    showAlert('alertTarget', 'info', 'Ingresaste $' + S.target + ' USD. ¬øQuisiste decir ' + S.target + ' puntos? Si es as√≠, cambia a Puntos.');
  }

  document.getElementById('empty').style.display='none';
  document.getElementById('resContent').style.display='';
  document.getElementById('resPanel').classList.add('has');

  // Lock operation names
  const lockOps = {
    PCS: { lock: 'Call Credit Spread (CCS)', structure: 'Iron Condor', dir: 'bajista' },
    CCS: { lock: 'Put Credit Spread (PCS)', structure: 'Iron Condor', dir: 'alcista' },
    PDS: { lock: 'Call Debit Spread (CDS)', structure: 'Box Spread', dir: 'alcista' },
    CDS: { lock: 'Put Debit Spread (PDS)', structure: 'Box Spread', dir: 'bajista' }
  };
  const lockInfo = lockOps[S.type];

  // ================================================================
  // CREDIT SPREAD LOCK (PCS/CCS):
  //   Worst P&L = PrimaRecibida + Cr√©ditoOpuesto - Ancho
  //   Break-even:      Cr√©ditoOpuesto = Ancho - PrimaRecibida
  //   Lock profit G:   Cr√©ditoOpuesto = Ancho - PrimaRecibida + G
  //   Limit loss L:    Cr√©ditoOpuesto = Ancho - PrimaRecibida - L
  //
  // DEBIT SPREAD LOCK (PDS/CDS):
  //   P&L = Ancho - (D√©bitoOriginal + D√©bitoBloqueo)
  //   Break-even:      D√©bitoBloqueo = Ancho - D√©bitoOriginal
  //   Lock profit G:   D√©bitoBloqueo = Ancho - D√©bitoOriginal - G
  //   Limit loss L:    D√©bitoBloqueo = Ancho - D√©bitoOriginal + L
  // ================================================================

  let required, lockLabel, lockSub;

  if (isCredit) {
    if (S.goal==='be')     required = W - P;
    if (S.goal==='profit') required = W - P + goalPts;
    if (S.goal==='loss')   required = W - P - goalPts;
    lockLabel = S.goal==='profit' ? 'CR√âDITO PARA ASEGURAR GANANCIA' : S.goal==='loss' ? 'CR√âDITO PARA LIMITAR P√âRDIDA' : 'CR√âDITO PARA BREAK-EVEN';
    lockSub = 'Cr√©dito m√≠nimo que debes cobrar en el ' + lockInfo.lock;
  } else {
    if (S.goal==='be')     required = W - P;
    if (S.goal==='profit') required = W - P - goalPts;
    if (S.goal==='loss')   required = W - P + goalPts;
    lockLabel = S.goal==='profit' ? 'D√âBITO M√ÅXIMO PARA ASEGURAR GANANCIA' : S.goal==='loss' ? 'D√âBITO M√ÅXIMO PARA LIMITAR P√âRDIDA' : 'D√âBITO M√ÅXIMO PARA BREAK-EVEN';
    lockSub = 'D√©bito m√°ximo que puedes pagar en el ' + lockInfo.lock;
  }

  // Validate result
  if (required <= 0) {
    document.getElementById('rVal').innerHTML = 'N/A';
    document.getElementById('rVal').className = 'r-val neu';
    document.getElementById('rLabel').textContent = 'OBJETIVO NO ALCANZABLE';
    document.getElementById('rSub').textContent = 'La combinaci√≥n de par√°metros no permite este objetivo. Ajusta la ganancia/p√©rdida deseada.';
    document.getElementById('rConv').textContent = '';
    document.getElementById('tWrap').style.display = 'none';
    document.getElementById('edu').classList.remove('vis');
    return;
  }

  // Display
  const uSuf = S.unit==='pts'?' pts':' USD';
  const dVal = S.unit==='pts' ? required.toFixed(2) : (required*100).toFixed(0);
  const vEl = document.getElementById('rVal');
  vEl.innerHTML = dVal + '<span class="r-unit">'+uSuf+'</span>';
  vEl.className = 'r-val pop pos';
  document.getElementById('rLabel').textContent = lockLabel;
  document.getElementById('rSub').textContent = lockSub;
  document.getElementById('rConv').textContent = S.unit==='pts' ? '= $'+(required*100).toFixed(0)+' USD' : '= '+required.toFixed(2)+' pts';

  // Target box
  const tw = document.getElementById('tWrap');
  const tb = document.getElementById('tBox');
  if (S.goal!=='be' && S.target>0) {
    tw.style.display=''; tb.classList.add('vis');
    const tv = S.target;
    if (S.goal==='profit') {
      document.getElementById('tDivLbl').textContent='Tu Objetivo de Ganancia';
      document.getElementById('tBoxLbl').className='t-lbl lg';
      document.getElementById('tBoxLbl').textContent='GANANCIA M√çNIMA GARANTIZADA';
      document.getElementById('tBoxVal').textContent='+'+(S.unit==='pts'?tv.toFixed(2)+' pts':'$'+tv.toFixed(0));
      document.getElementById('tBoxVal').className='t-val vg';
      document.getElementById('tBoxSub').textContent=S.unit==='pts'?'= $'+(tv*100).toFixed(0)+' USD en el peor caso':'= '+(tv/100).toFixed(2)+' pts en el peor caso';
      if (isCredit) {
        document.getElementById('tBoxExpl').innerHTML='Cobra al menos <strong>'+dVal+uSuf+'</strong> en el <strong>'+lockInfo.lock+'</strong> para asegurar esta ganancia.';
      } else {
        document.getElementById('tBoxExpl').innerHTML='Paga como m√°ximo <strong>'+dVal+uSuf+'</strong> en el <strong>'+lockInfo.lock+'</strong> para asegurar esta ganancia.';
      }
    } else {
      document.getElementById('tDivLbl').textContent='Tu L√≠mite de P√©rdida';
      document.getElementById('tBoxLbl').className='t-lbl lr';
      document.getElementById('tBoxLbl').textContent='P√âRDIDA M√ÅXIMA CON BLOQUEO';
      document.getElementById('tBoxVal').textContent='-'+(S.unit==='pts'?tv.toFixed(2)+' pts':'$'+tv.toFixed(0));
      document.getElementById('tBoxVal').className='t-val vr';
      document.getElementById('tBoxSub').textContent=S.unit==='pts'?'= -$'+(tv*100).toFixed(0)+' USD m√°ximo':'= -'+(tv/100).toFixed(2)+' pts m√°ximo';
      if (isCredit) {
        document.getElementById('tBoxExpl').innerHTML='Cobra al menos <strong>'+dVal+uSuf+'</strong> en el <strong>'+lockInfo.lock+'</strong> para limitar tu p√©rdida.';
      } else {
        document.getElementById('tBoxExpl').innerHTML='Paga como m√°ximo <strong>'+dVal+uSuf+'</strong> en el <strong>'+lockInfo.lock+'</strong> para limitar tu p√©rdida.';
      }
    }
  } else { tw.style.display='none'; tb.classList.remove('vis'); }

  // Build formula
  document.getElementById('edu').classList.add('vis');
  buildEdu(isCredit, W, P, required, goalPts, lockInfo);
}

function showAlert(containerId, type, msg) {
  const el = document.getElementById(containerId);
  el.innerHTML = `<div class="alert ${type}"><span class="alert-icon">${type==='warn'?'‚ö†Ô∏è':'üí°'}</span><span>${msg}</span></div>`;
}

function buildEdu(isCredit, W, P, X, G, lockInfo) {
  const f = v => v.toFixed(2);
  const c = (col, txt) => `<span style="color:var(--accent-${col});font-weight:600">${txt}</span>`;
  const spreadName = { PCS:'Put Credit Spread', CCS:'Call Credit Spread', PDS:'Put Debit Spread', CDS:'Call Debit Spread' }[S.type];

  // Lock badge
  const varsEl = document.getElementById('eduVars');
  const badgeClass = isCredit ? 'lb-credit' : 'lb-debit';
  let html = `<div class="lock-badge ${badgeClass}">
    <span class="lb-arrow">${isCredit?'üîí':'üîí'}</span>
    <span><span class="lb-name">${spreadName}</span> se bloquea con ‚Üí <strong>${lockInfo.lock}</strong><br>
    <span style="font-size:.75rem;font-weight:400;opacity:.8">Esto forma un <strong>${lockInfo.structure}</strong> ‚Äî el spread opuesto es ${lockInfo.dir}</span></span>
  </div>`;

  // Variables
  html += `<div style="display:flex;flex-wrap:wrap;gap:8px">`;
  html += `<div class="ev"><span class="ev-icon">üìè</span><span class="ev-name">Ancho del Spread =</span><span class="ev-val">${f(W)}</span></div>`;
  html += `<div class="ev"><span class="ev-icon">${isCredit?'üí∞':'üí∏'}</span><span class="ev-name">${isCredit?'Prima Recibida':'D√©bito Pagado'} =</span><span class="ev-val">${f(P)}</span></div>`;
  if (S.goal==='profit') html += `<div class="ev"><span class="ev-icon">üéØ</span><span class="ev-name">Ganancia Deseada =</span><span class="ev-val">${f(G)}</span></div>`;
  if (S.goal==='loss') html += `<div class="ev"><span class="ev-icon">üõ°Ô∏è</span><span class="ev-name">P√©rdida M√°xima =</span><span class="ev-val">${f(G)}</span></div>`;
  html += `</div>`;
  varsEl.innerHTML = html;

  // Steps
  const sEl = document.getElementById('eduSteps');
  let s = '';

  if (isCredit) {
    s += step(1, `Abriste un <strong>${spreadName}</strong> y cobraste ${c('amber',f(P))} de prima. Tu riesgo m√°ximo sin bloqueo:`,
      `${c('blue','Ancho')} ‚àí ${c('amber','Prima Recibida')} = ${f(W)} ‚àí ${f(P)} = ${c('red',f(W-P))}`);

    s += step(2, `Para bloquear, abres un <strong>${lockInfo.lock}</strong> (${lockInfo.dir}) del mismo ancho. Ambos credit spreads forman un <strong>${lockInfo.structure}</strong>. En el peor caso, uno pierde el ancho completo:`,
      `Peor caso = ${c('amber','Prima Recibida')} + ${c('green','Cr√©dito del ' + lockInfo.lock)} ‚àí ${c('blue','Ancho')}`);

    if (S.goal==='be') {
      s += step(3, `Para <strong>break-even</strong>, el peor caso debe ser $0:`,
        `${c('amber','Prima Recibida')} + ${c('green','Cr√©dito Opuesto')} ‚àí ${c('blue','Ancho')} = 0`);
      s += stepR(`${c('green','Cr√©dito Opuesto')} = ${c('blue','Ancho')} ‚àí ${c('amber','Prima Recibida')}<br>${c('green','Cr√©dito Opuesto')} = ${f(W)} ‚àí ${f(P)} = <span style="color:var(--accent-green);font-size:1.15em"><strong>${f(X)}</strong></span>`);
    } else if (S.goal==='profit') {
      s += step(3, `Para asegurar una ganancia de ${c('green',f(G))}, el peor caso debe igualar esa ganancia:`,
        `${c('amber','Prima Recibida')} + ${c('green','Cr√©dito Opuesto')} ‚àí ${c('blue','Ancho')} = ${c('green','Ganancia Deseada')}`);
      s += stepR(`${c('green','Cr√©dito Opuesto')} = ${c('blue','Ancho')} ‚àí ${c('amber','Prima Recibida')} + ${c('green','Ganancia Deseada')}<br>${c('green','Cr√©dito Opuesto')} = ${f(W)} ‚àí ${f(P)} + ${f(G)} = <span style="color:var(--accent-green);font-size:1.15em"><strong>${f(X)}</strong></span>`);
    } else {
      s += step(3, `Para limitar la p√©rdida a ${c('red',f(G))}, el peor caso debe ser esa p√©rdida negativa:`,
        `${c('amber','Prima Recibida')} + ${c('green','Cr√©dito Opuesto')} ‚àí ${c('blue','Ancho')} = ‚àí${c('red','P√©rdida M√°xima')}`);
      s += stepR(`${c('green','Cr√©dito Opuesto')} = ${c('blue','Ancho')} ‚àí ${c('amber','Prima Recibida')} ‚àí ${c('red','P√©rdida M√°xima')}<br>${c('green','Cr√©dito Opuesto')} = ${f(W)} ‚àí ${f(P)} ‚àí ${f(G)} = <span style="color:var(--accent-green);font-size:1.15em"><strong>${f(X)}</strong></span>`);
    }

  } else {
    // DEBIT SPREAD
    s += step(1, `Abriste un <strong>${spreadName}</strong> y pagaste ${c('amber',f(P))} de d√©bito. Tu riesgo m√°ximo es lo que pagaste:`,
      `Riesgo original = ${c('amber','D√©bito Pagado')} = ${c('red',f(P))}`);

    s += step(2, `Para bloquear, abres un <strong>${lockInfo.lock}</strong> (${lockInfo.dir}) del mismo ancho. Ambos debit spreads forman un <strong>${lockInfo.structure}</strong> que vale exactamente el ancho al expirar:`,
      `Valor al expirar = ${c('blue','Ancho')} = ${c('green',f(W))}<br>Costo total = ${c('amber','D√©bito Original')} + ${c('purple','D√©bito del ' + lockInfo.lock)}<br>Ganancia = ${c('blue','Ancho')} ‚àí Costo total`);

    if (S.goal==='be') {
      s += step(3, `Para <strong>break-even</strong>, la ganancia debe ser $0:`,
        `${c('blue','Ancho')} ‚àí ${c('amber','D√©bito Original')} ‚àí ${c('purple','D√©bito Bloqueo')} = 0`);
      s += stepR(`${c('purple','D√©bito Bloqueo')} = ${c('blue','Ancho')} ‚àí ${c('amber','D√©bito Original')}<br>${c('purple','D√©bito Bloqueo')} = ${f(W)} ‚àí ${f(P)} = <span style="color:var(--accent-purple);font-size:1.15em"><strong>${f(X)}</strong></span>`);
    } else if (S.goal==='profit') {
      s += step(3, `Para asegurar una ganancia de ${c('green',f(G))}, el resultado debe ser al menos esa ganancia:`,
        `${c('blue','Ancho')} ‚àí ${c('amber','D√©bito Original')} ‚àí ${c('purple','D√©bito Bloqueo')} = ${c('green','Ganancia Deseada')}`);
      s += stepR(`${c('purple','D√©bito Bloqueo')} = ${c('blue','Ancho')} ‚àí ${c('amber','D√©bito Original')} ‚àí ${c('green','Ganancia Deseada')}<br>${c('purple','D√©bito Bloqueo')} = ${f(W)} ‚àí ${f(P)} ‚àí ${f(G)} = <span style="color:var(--accent-purple);font-size:1.15em"><strong>${f(X)}</strong></span>`);
    } else {
      s += step(3, `Para limitar la p√©rdida a ${c('red',f(G))}, el resultado puede ser negativo hasta ese monto:`,
        `${c('blue','Ancho')} ‚àí ${c('amber','D√©bito Original')} ‚àí ${c('purple','D√©bito Bloqueo')} = ‚àí${c('red','P√©rdida M√°xima')}`);
      s += stepR(`${c('purple','D√©bito Bloqueo')} = ${c('blue','Ancho')} ‚àí ${c('amber','D√©bito Original')} + ${c('red','P√©rdida M√°xima')}<br>${c('purple','D√©bito Bloqueo')} = ${f(W)} ‚àí ${f(P)} + ${f(G)} = <span style="color:var(--accent-purple);font-size:1.15em"><strong>${f(X)}</strong></span>`);
    }
  }
  sEl.innerHTML = s;

  // Tip
  const tip = document.getElementById('eduTip');
  const fmt = v => S.unit==='pts' ? v.toFixed(2)+' pts' : '$'+(v*100).toFixed(0);

  if (S.goal==='profit') {
    tip.innerHTML = `<div class="edu-tip tg">üí° Si ${isCredit?'cobras al menos':'pagas como m√°ximo'} <strong>${fmt(X)}</strong> en el <strong>${lockInfo.lock}</strong>, tu ganancia queda <strong>garantizada</strong> sin importar hacia d√≥nde se mueva el precio al expirar.</div>`;
  } else if (S.goal==='loss') {
    tip.innerHTML = `<div class="edu-tip ta">üí° Con ${isCredit?'un cr√©dito':'un d√©bito'} de <strong>${fmt(X)}</strong> en el <strong>${lockInfo.lock}</strong>, tu p√©rdida m√°xima queda limitada. ${isCredit?'Si cobras m√°s':'Si pagas menos'}, la p√©rdida ser√° a√∫n menor.</div>`;
  } else {
    tip.innerHTML = `<div class="edu-tip tb">üí° Con exactamente <strong>${fmt(X)}</strong> en el <strong>${lockInfo.lock}</strong> llegas a break-even. ${isCredit?'Cualquier cr√©dito por encima':'Cualquier d√©bito por debajo'} de eso se convierte en <strong>ganancia garantizada</strong>.</div>`;
  }
}

function step(n, desc, eq) {
  return `<div class="es"><div class="es-n">${n}</div><div class="es-b"><div class="es-d">${desc}</div><div class="es-eq">${eq}</div></div></div>`;
}
function stepR(eq) {
  return `<div class="es"><div class="es-n done">‚úì</div><div class="es-b"><div class="es-d">Despejamos el valor necesario del spread opuesto:</div><div class="es-eq final">${eq}</div></div></div>`;
}

prog();
</script>
</body>
</html>
